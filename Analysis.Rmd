---
title: "Baseballr EDA"
author: "Charlie Braverman, Beili Chou, Andrew Hack"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction



## Conventions

with_underscores

Variables: nouns

Functions: verbs

Automated ball-strike challenge system -\> ABS

Major League Baseball -\> MLB

## Packages

Uncommon pkgs: baseballr @baseballr

baseballr is a package written for R focused on baseball analysis. It
includes functions for scraping various data from websites, such as
FanGraphs.com, Baseball-Reference.com, and baseballsavant.mlb.com. It
also includes functions for calculating metrics, such as wOBA, FIP, and
team-level consistency over custom time frames.

You can read more about some of the functions and how to use them at its
official site, <http://billpetti.github.io/baseballr/index.html>.

```{r load pkgs, warning=FALSE, message=FALSE}
library(tidyverse)
library(baseballr)
```

## Data

Statcast provides pitch-by-pitch data for every game played in MLB. Our
approach will be to pull pitch data and join with another data set that
holds: batter_id, batter_name, and batter_height. This full data set
will allow for us to sort by batter produce the new rulebook strikezone
for each. 

Further documentation on variable names and their meanings can be found here: https://baseballsavant.mlb.com/csv-docs


```{r load data, results='hide', collapse=TRUE}
zack_wheeler_id <- playerid_lookup(last_name = "Wheeler", first_name = "Zack") %>% pull(mlbam_id)
zack_wheeler_data <- statcast_search_pitchers(start_date = "2024-01-01",
                                                   end_date = "2024-12-31",
                                                   pitcherid = zack_wheeler_id)
write.csv(zack_wheeler_data, file = "data/wheeler_pitch_data_2024.csv")
```

Taking a look at pitch location data, which is broken down into x (horizontal) and z (vertical) coordinates:

```{r descriptives}
plate_x_bplot <- ggplot(zack_wheeler_data, aes(x = plate_x)) +
  geom_boxplot() +
  labs(title = "plate_x descriptive statistics", x = "Distance from center of plate (feet)")

plate_z_bplt <- ggplot(zack_wheeler_data, aes(y = plate_z)) +
  geom_boxplot() +
  labs(title = "plate_z descriptive statistics", y = "Distance from ground (feet)")

plate_x_bplot + geom_vline(aes(xintercept = mean(plate_x), color = "mean"), linetype = "dashed")

plate_z_bplt + geom_hline(aes(yintercept = mean(plate_z), color = "mean"), linetype = "dashed")

summary(zack_wheeler_data$plate_x)

summary(zack_wheeler_data$plate_z)
```

And taking a look at how much the strikezone varies across different batters/game operators:

```{r strikezone descriptive}
sz_top_bplot <- ggplot(zack_wheeler_data, aes(y = sz_top)) +
  geom_boxplot() +
  labs(title = "sz_top descriptive statistics", y = "Distance from ground (feet)")

sz_bot_bplt <- ggplot(zack_wheeler_data, aes(y = sz_bot)) +
  geom_boxplot() +
  labs(title = "sz_bot descriptive statistics", y = "Distance from ground (feet)")

sz_top_bplot + geom_hline(aes(yintercept = mean(sz_top), color = "mean"), linetype = "dashed")

sz_bot_bplt + geom_hline(aes(yintercept = mean(sz_bot), color = "mean"), linetype = "dashed")
summary(zack_wheeler_data$sz_top)
summary(zack_wheeler_data$sz_bot)
```

## EDA

Some initial thoughts:

#### Generating new strikezone sizes:

```         
Start

  Mutate and create columns for bottom and top of strikezone height
  
    .27 x batter_height, .535 x batter_height
    
  Strikezone width is standard for all players
  
    17 inches (format consistent with provided data)
    
End
```

#### Calculating strikezone differences for 2024:

```         
Start

  Mutate and create % strikezone diff
  
    Calculate average height x width for recorded strikezone and compare % area difference to ABS strikezone.
    
  Mutate and create batting average on balls in zone (BABIZ) for old and new zones
  
    Filter for pitches located in each zone, respectively, and calculate average
  
  Repeat for interesting stats
  
    wOBA/BABIPIZ/...
    
  Compare players who benefit vs suffer
  
    Group_by, sort
    
End
```

#### Long-term: model player performances for 2024 if strikezone was ABS size:

```         
Start

  Create distance from  strikezone metric
  
    ball_loc-nearest strikezone edge
    
  Train model on distance from strikezone edge, count, more etc
  
    Start with metrics like BA, can model other stats as well, ~ distance_from_zone, count, pitch velo, pitch break, etc
    
  Mutate predicted field to be NA for each pitch that is on the line between old and new zone
  
    filter for pitch location in ABS-Zone distance away from zone, make NA
    
  Predict outcome for those limbo-state pitches with new strike zone
  
  Make sure model is trained so if a batter would swing at a pitch on the edge of old zone, their habits stay true (and same if not swinging)
  
  Calculate difference in WAR, other key metrics for players. Who performed better? Worse?
  
End
```
